<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	 
    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
   
<title>resumableBoundaryWalker</title></head>
    
<body>
<div id="top">
<h1>Lab ISS | the project resumableBoundaryWalker<font size="5"></font> </h1>
</div>  

<div class="body"> 
<h2>Introduction</h2>
This case-study starts to deal with the design and development of proactive/reactive software systems which work under user-control.
 
<h2>Requirements</h2>

 
<div class="remark">
 
Design and build a software system (named from now on 'the application') that leads the robot described in 
<a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/master/it.unibo.virtualRobot2020/userDocs/VirtualRobot2021.html" target="lab"><em>VirtualRobot2021.html</em></a> 
to walk along the boundary of a empty, rectangular room under user control. 
<br/>
More specifically, the <ks>user story</ks> can be summarized as follows:
<br/>
<table style="width:98%">
<tbody>	

<tr>
<td style="width:65%" >
the robot is initially located at the <ks>HOME</ks> position, as shown in the picture on the rigth
</td>
<td><center><img src="./img/emptyGridWithHome.png" alt="emptyGridWithHome" width="35%"></center>
</td>
</tr>

<tr>
<td style="width:65%" >
 the application presents to the user a <ks>consoleGui</ks> similar to that shown in the picture on the rigth
</td>
<td><center><img src="./img/stopResumeConsole.png" alt="stopResumeConsole" width="35%"></center>
</td>
</tr>



<tr>
<td style="width:65%" >
when the user hits the button <k>RESUME</k> the robot <ks>starts or continue to walk</ks> along the boundary, while
updating a <ks>robot-moves history</ks>;
</td>
<td> 
</td>
</tr>

<tr>
<td style="width:65%" >
when the user hits the button <k>STOP</k> the robot stop its journey, waiting for another <k>RESUME</k> ;
</td>
<td> 
</td>
</tr>

<tr>
<td style="width:65%" >
when the robot reachs its <ks>HOME</ks> again, the application <i>shows the robot-moves history</i> on the standard output device.
</td>
<td> 
</td>
</tr>


 </tbody>
</table>

 
</div>

 <h3>Delivery</h3>
The customer <ks>hopes to receive</ks> a working prototype (written in Java ) of the application by <k>Monady 22 March</k>. 
The name of this file (in pdf) should be:
<pre>
cognome_nome_resumablebw.pdf
</pre>

<h2>Requirement analysis</h2>
<div class="remark">
The constumer requires to design and buid a software system that is able to drive a <i>robot</i> to walk along the boundary of an empty, rectangula room under user control. The interview with the constumer clarified the meaning of the used nouns that are the following:
<ul>
    <li><ks>robot</ks>: device already owned by the consumer and able to walk by receiving commands. The robot is fully described in <a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/master/it.unibo.virtualRobot2020/userDocs/VirtualRobot2021.html" target="lab">VirtualRobot2021.html</a>, a document provided by the consumer;</li>
    <li><ks>room</ks>: a conventional room found in all ordinary buildings;</li>
    <li><ks>boudary</ks>: the perimeter of the physical room delimited by <ks>walls</ks>;</li>
    <li><ks>home</ks>: the start point of the robot, located at the top left corner of the rectangular room;</li>
    <li><ks>consoleGui</ks>: the graphical user interface that the application must present to the user; </li>
	<li><ks>button</ks>: a button into the consoleGui that when pressed produces a certain action; the consumer requested two button: 
	<ul>
		<li><k>RESUME</k>: when the user press this button, the robot start or continue to walk around the boundary;</li>
		<li><k>STOP</k>: when the user press this button, the robot stop to walk waiting that the user press the resume button;</li>
		</ul></li>
    <li><ks>robot-moves history</ks>: sequence of the movements performed by the robot.</li>
</ul>
	
	</br>
About the meaning of the verbs used in the interaction with the consumer:
<ul>
    <li><ks>walk</ks>: the ability of the robot to move thanks to the means of locomotion it is equipped with; constumer also specifies that the robot must move forward flanking the walls.</li>
</ul>
</br>

<k>The robot is able to receive command in <i>cril language</i> coded into JSON strings</k> that can be <k>encapsulated in HTTP POST messages</k> or <k>sent on a websocket</k> as specified in <a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/master/it.unibo.virtualRobot2020/userDocs/VirtualRobot2021.html#interaction" target="lab">VirtualRobot2021.html</a>.

Consumer also required that <k>the working prototype must be written in <em>Java</em></k>.


</div>

<h2>Problem analysis</h2>
<div class="remark">
	<h3>Relevant aspects</h3>
<ol>
<li>From the requirement analysis it emerged that the system that is about to be implemented must communicate with the robot via HTTP or via websocket using commands coded in JSON String. In order to do this it need to create a <k>distributed system</k> with two main components:
<ul>
    <li>the <ks>robot</ks> provided by the consumer;</li>
    <li>an <ks>application</ks> able to send the command to the robot.</li>
</ul>The application will be called <ks><em>resumableBoudaryWalker</em></ks>.</li>
	</br>
	<li>As anticipated, the robot and the application can communicate:
<ul>
    <li>sending messages to the port 8090 with <ks>HTTP Request/Response</ks>;</li>
    <li>sending messages to the port 8091 using <ks>websocket</ks>.</li>
</ul>In addition to, as specified, the commands must be coded in <ks>JSON string</ks>.
	</li>
</ol>

</br>
To realize communication the application must have a software part able to use HTTP or websocket and another part able to parse and use JSON data. There are lots of library for almost all languages but <k>there is an operative abstracion-gap</k>, since <kc>the required logical interaction is not always a request-response</kc>. In particular, to realize the asynchronous interaction with HTTP are needed little code tricks.


<h3>Logical Architecture</h3>
In the relevant aspects it was said that system has two main components then logical architecture is the following:
<table style="width:98%">
    <tbody>	
    <tr>
    <td style="width:40%" >
     <center><img src="./img/logical_architecture_schema.png" alt="logical architecture schema" width="90%" ></center>
     
    
    </td>
    <td>For now <ks>resumableBoundaryWalker</ks> it's a generic component (entity) and it will be clarified in progect phase. <ks>WEnv</ks> is the environment of the robot able to receive commands via HTTP or websocket.
    <br/><br/>
    About interaction instead:
    <ul>
        <li>the use of <ks>HTTP</ks> seems very suitable and very portable thanks to the existence of lots of API;</li>
        <li>the use of <ks>websocket</ks> could be much more efficent decreasing the overhead costs of HTTP messages and in addition to the usage of this component allows asynchronous interation in a natural way.</li>
    </ul>
    </td>
    </tr>
    </tbody>
</table>
</br>
<center><img src="./img/logical_architecture_legend.png" alt="logical architecture legend" width="50%" ></center>

We observe that:
<ul>
<li>The specification of the exact 'nature' of our <em>resumableBoundaryWalker</em> software is left to the designer. 
However, we can say here that is it <b>not a database, or a function or an object</b>.  
<li>To make our <em>resumableBoundaryWalker</em> software <k>as much as possibile independent</k> from the undelying communication protocols,
the designer could make reference to proper <a href="https://it.wikipedia.org/wiki/Design_pattern" target="web"><em>design pattern</em></a>, 
e.g.
<a href="https://it.wikipedia.org/wiki/Adapter_pattern" target="web"><ks>Adapter</ks></a>, 
<a href="https://it.wikipedia.org/wiki/Bridge_pattern" target="web"><ks>Bridge</ks></a>,
<a href="https://it.wikipedia.org/wiki/Fa%C3%A7ade_pattern" target="web"><ks>Facade</ks></a>.
<a href="https://it.wikipedia.org/wiki/Observer_pattern" target="web"><ks>Observer</ks></a>.
 </li>
</ul>

<h3>Reasources already available</h3>
The following resources could be usefully exploited to reduce the development time of a first prototype of the application:

<ol>
<li>The  <a href="./it.unibo.virtualrobotclient/app/src/main/java/it/unibo/consolegui/Consolegui.java" target="code">Consolegui.java</a>  
(in project <a href="./it.unibo.virtualrobotclient/app/src/main/java/it/unibo/consolegui" target="code">it.unibo.virtualrobotclient</a>) </li>

<li>The  <a href="./it.unibo.virtualrobotclient/app/src/main/java/it/unibo/wenv/RobotMovesInfo.java" target="code">RobotMovesInfo.java</a>  
(in project <a href="./it.unibo.virtualrobotclient/app/src/main/java/it/unibo/wenv" target="code">it.unibo.virtualrobotclient</a>) </li>


<li>The  <a href="./it.unibo.virtualrobotclient/app/src/main/java/it/unibo/wenv/RobotInputController.java" target="code">RobotInputController.java</a>  
(in project <a href="./it.unibo.virtualrobotclient/app/src/main/java/it/unibo/wenv" target="code">it.unibo.virtualrobotclient</a>) </li>
</ol>

<h3>Application Logic</h3>
It is quite to define <k>what the robot has to do</k> to meet the requirements:
<pre>
let us define <kc>emum direction {UP,DOWN,LEFT,RIGHT}</kc>
let us define <kc>list robot-history</kc>
the robot start in the HOME position, direction=DOWN
the gui present to the user the buttons RESET and STOP

when user press RESUME:
  for 4 times: 
	1) send to the robot the request to execute the command <kc>moveForward</kc> 
	   and continue to do it updating the robot-history list,
	   until the answer of the request becomes 'false'
	   or the user press STOP button
	2) if the user pressed STOP, wait until RESUME is pressed;
	3) send to the robot the request to execute the <kc>turnLeft</kc>
  print robot-history contents to stdOut
</pre>


The expected time required for the development of the application is (no more than) 6 hours.
</div>
	
<h2>Test plans</h2>
<div class="remark">
To check that the application requirement for doing boundary, we could keep track of the moves done by the robot.
For example:

<pre>
...
let us define <kc>String moves="";</kc>
for 4 times: 
	1) send to the robot the request to execute the command <kc>moveForward</kc>;
	if the answer is 'true' <ks>append the symbol "w"</ks> to <kc>moves</kc> and continue to do 1); 
	2) when the answer of the request becomes 'false',
	send to the robot the request to execute the command <kc>turnLeft</kc> and <ks>append the symbol "l"</ks> to <kc>moves</kc>
</pre>

In this way, when the application terminates, the string <kc>moves</kc> should have the typical structure of a 
<a href="https://en.wikipedia.org/wiki/Regular_expression" target="web"><em>regular expression</em></a>,
that can be easily checked with a TestUnit software:
<pre><kc>moves</kc>: <ks>"w*lw*lw*lw*l"</ks>     <kc><ks>*</ks> : repetion N times(N>=0) </pre>
</div>


<h2>Project</h2>
<div class="remark">

	<table style="width:98%">
		<tbody>
			<tr><td>
				<h3>Nature of the application component</h3>
				The <em>resumableBoundaryWalker</em> application is a <k>conventional Java program</k>, represented by multiple levels.
				The entire application can be represented by the following UML that will be zommed soon:</br></br>
				<center><img src="./img/mainUML.png" alt="commands_uml" width="90%" ></center></br></br>
		</br></br>
			</td></tr>
			<tr><td>
				<h3>Command Level (package <ks>it.unibo.resumableBoundaryWalker.commands</ks>)</h3>
				This package provides the necessary classes to map the messages sent via network in the object world.</br></br>
				<center><img src="./img/it.unibo.robot.commands.png" alt="commands_uml" width="90%" ></center></br></br>
				<ul>
					<li><ks>RobotCommand</ks>: represents the cril command sendable via network;</li>
					<li><ks>RobotMovement</ks>: represents the response received in cril language and then, in other words, the movement performed by the robot;</li>
					<li><ks>RobotInformation, SonardData, SensorData</ks>: represent the data emitted by the the sonars and the sensors;</li>
					<li><ks>CommandFactory</ks>: as specified in the <em>Factory Pattern</em>, this static interface lets to easily create the objects of RobotCommand class;</li>
					<li><ks>RobotSpeaker</ks>: interface that defines a component able to encode and parse the commands from/to the network (JSON) by/to the object worlds;</li>
					<li><ks>CrilRobotSpeaker</ks>: implementation of RobotSpeaker for the entire application; notice that this class is a <em>Singleton</em> (this is the reason for the private constructor);</li>
					<li><ks>Move, MoveResult, Emitter</ks>: utility enumeratives.</li>
				</ul>
				
				It's important to specify that <k>the objects of the class RobotCommand are only instantiable thanks to the Factory</k> meanwhile <k>only CrilRobotSpeaker can create the object of the classes RobotMovement and RobotInformation</k>.</br>
In addition to this, notice that <k>RobotInformation is a parametric class</k>: the possible parametrizations are SonarData or SensorData and it's easily intuitive.</br>
				Finally, it's important to specify that the attributes <ks>MOVES</ks> and <ks>MOVES_RESULTS</ks> have relevant role in encoding and parsing commands/information and in a future development this two variable can be populated by some values contained in a configuration file for a most realiable way. For now, their values are the same:
				<pre>
<k>private final static</k> BiMap<Move, String> <ks>MOVES</ks> = HashBiMap.create(5);
<k>private final static</k> Map<String, MoveResult> <ks>MOVE_RESULTS</ks> = new HashMap<String, MoveResult>();
<k>static</k> {
	MOVES.put(Move.MOVE_FORWARD, <kc>"moveForward"</kc>);
	MOVES.put(Move.MOVE_BACKWARD, <kc>"moveBackward"</kc>);
	MOVES.put(Move.TURN_LEFT, <kc>"turnLeft"</kc>);
	MOVES.put(Move.TURN_RIGHT, <kc>"turnRight"</kc>);
	MOVES.put(Move.ALARM, <kc>"alarm"</kc>);

	MOVE_RESULTS.put(<kc>"true"</kc>, MoveResult.SUCCEDED);
	MOVE_RESULTS.put(<kc>"false"</kc>, MoveResult.FAILED);
	MOVE_RESULTS.put(<kc>"halted</kc>", MoveResult.HALTED);
	MOVE_RESULTS.put(<kc>"notallowed</kc>", MoveResult.NOT_ALLOWED);
}
				</pre>
		</br></br>
			</td></tr>
			<tr><td>
				<h3>Support Level (package <ks>it.unibo.resumableBoundaryWalker.supports</ks>)</h3>
				This package provides the necessary classes to realize communication between the application and the robot.</br></br>
				<center><img src="./img/it.unibo.robot.supports.png" alt="supports_uml" width="90%" ></center></br></br>
<ul>
	<li><ks>IssSupport</ks>: the interface that defines the behavior of the objects that carry out the communication with the robot;</li>
	<li><ks>IssObservableSupport</ks>: an abstract class that realizes the <em>Observer Pattern</em> for the IssSupport;</li>
	<li><ks>IssHttpSupport, IssWsSupport</ks>: classes that extend IssObservableSupport and then respectively carry out the communication  in Http and WebSocket protocols; these classes use the RobotSpeaker in order to encode and parse the messages;</li>
	<li><ks>IssObservableSupportFactory</ks>: an abstract class that realizes the <em>Factory Pattern</em> for the supports;</li>
	<li><ks>IssSupportObserver</ks>: an interface that defines the behavior of an Observer;</li>
	<li><ks>IssProtocol</ks>: utity enumeratives for the factory.</li>
</ul>
It's very important to say that, also in this case, have been use two variable (<ks>DEFAULT_PROTOCOL_URL</ks> and <ks>DEFAULT_PROTOCOL</ks>) in the class IssObservableSupportFactory with any default values that can be populated thanks to a configuration file in a future development. Anyway, it's logical to say that the most suitable protocol is websocket than, for now, this is sufficient. We report the entire code of the factory:
<pre>
<k>public abstract class</k> IssObservableSupportFactory {

	<k>private static final</k> IssProtocol <ks>DEFAULT_PROTOCOL</ks> = IssProtocol.WS;
	<k>private static final</k> String D<ks>DEFAULT_PROTOCOL_URL</ks> = "ws://localhost:8091";

    <k>public static</k> IssObservableSupport createSupport() <k>throws</k> NoSuchIssProtocolException,
            DeploymentException, IOException, URISyntaxException {
        return createSupport(DEFAULT_PROTOCOL, DEFAULT_PROTOCOL_URL);
    }

    <k>public static</k> IssObservableSupport createSupport(IssProtocol protocol, String url)
            <k>throws</k> NoSuchIssProtocolException, DeploymentException, IOException, URISyntaxException {
        RobotSpeaker speaker = CrilRobotSpeaker.getSpeaker();
        switch (protocol) {
            case WS:
                return new IssWsSupport(url, speaker);

            case HTTP:
                return new IssHttpSupport(url, speaker);

            default:
                throw new NoSuchIssProtocolException(protocol + " not available.");
        }
    }
}
</pre>

Even if it's not specified in the UML, in order to realize the "asynchronous" interaction with HTTP, <k>the class IssHttpSupport must implements the interface Runnable</k>, provided by the Java Standard Libraries. In addition to this, in order to manage the thread, it's needed to use a <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/BlockingQueue.html" target="blocking_queue"><em>BlockingQueue</em></a> and also an <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/atomic/AtomicBoolean.html" target="atomic_boolean"><em>AtomicBoolean</em></a>. For this reason we report the code of this class that use <a href="http://hc.apache.org/httpcomponents-client-5.0.x/" target="http_client"><em>org.apache.HttpClient</em></a> library:
<pre>
<k>public class</k> IssHttpSupport <k>extends</k> IssObservableSupport <k>implements</k> Runnable{

    <k>private static final</k> int BUFFER_CAPACITY = 10;

    <k>private</k> CloseableHttpClient httpClient;
    <k>private</k> URI URL;

    <k>private</k> BlockingQueue&ltRobotCommand&gt commands;
    <k>private</k> AtomicBoolean service;

    <k>protected</k> IssHttpSupport(String URL, RobotSpeaker speaker) <k>throws</k> URISyntaxException {
        super(speaker);
        this.httpClient = HttpClients.createDefault();
        this.URL = new URI(URL);

        this.commands = new ArrayBlockingQueue<>(BUFFER_CAPACITY);
        service = new AtomicBoolean(false);
        new Thread(this).start();
    }

    <ks>@Override</ks>
    <k>public</k> void requestAsync(RobotCommand command) <k>throws</k>  IOException{
        try {
            commands.put(command);
        } catch (InterruptedException e) {
            throw new IOException(e);
        }

        notifyAsyncRequest(command);
    }

    <ks>@Override</ks>
    <k>public</k> RobotMovement requestSync(RobotCommand command) <k>throws</k> IOException {
        StringEntity entity     = new StringEntity(speaker.encode(command));
        HttpUriRequest httppost = null;
        httppost = RequestBuilder.post()
                .setUri(URL)
                .setHeader("Content-Type", "application/json")
                .setHeader("Accept", "application/json")
                .setEntity(entity)
                .build();
        CloseableHttpResponse response = httpClient.execute(httppost);
        String jsonResponse = EntityUtils.toString( response.getEntity() );

        RobotMovement movement = speaker.parseMovement(jsonResponse);
        if(movement != null) {
            notifySyncRequest(command, movement);
        }

        return movement;
    }

    <ks>@Override</ks>
    <k>public</k> void onReceived(String message) {
        RobotMovement movement = speaker.parseMovement(message);
        if(movement != null)
            notifyRobotMovementReceived(movement);
    }

    <ks>@Override</ks>
    <k>public</k> void close() <k>throws</k> IOException {
        httpClient.close();

        service.set(false);
        try {
            commands.put(CommandFactory.createCommand(Move.MOVE_FORWARD, -1));
        } catch (InterruptedException e) {
            throw new IOException(e);
        }
    }

    <ks>@Override</ks>
    <k>public</k> void run() {
        service.set(true);

        RobotCommand command = null;
        try {
            while(true) {
                command = commands.take();
                if(service.get() == false || command.getTime() &lt= 0) {
                    commands.clear();
                    return;
                }

                StringEntity entity     = new StringEntity(speaker.encode(command));
                HttpUriRequest httppost = RequestBuilder.post()
                        .setUri(URL)
                        .setHeader("Content-Type", "application/json")
                        .setHeader("Accept", "application/json")
                        .setEntity(entity)
                        .build();
                CloseableHttpResponse response = httpClient.execute(httppost);
                String jsonResponse = EntityUtils.toString( response.getEntity() );

                onReceived(jsonResponse);

            }
        } catch(Exception e) {
            e.printStackTrace();
        }
    }
</pre>

About IssWsSupport, it's very easy to use the library <a href="https://javaee.github.io/javaee-spec/javadocs/javax/websocket/package-summary.html" target="javax_ws"><em>javax.websocket</em></a>.</br></br>

</td></tr>
<tr><td>
	<h3>Controller Level (package <ks>it.unibo.resumableBoundaryWalker.controller</ks>)</h3>
	This package provides the controller of the entire application.</br></br>
	<center><img src="./img/it.unibo.resumableBoundaryWalk.controller.png" alt="controller_uml" width="70%" ></center></br></br>
<ul>
	<li><ks>RobotMovesInfo</ks>: a class that represents the history of a journey and that memorizes the performed movements; this class was initially given by the consumer but has been adapted with the newer packages;</li>
	<li><ks>RobotMoveLogic</ks>: the classes that implements this interface realize the bussiness logic for the sequence of the movements of the robot;</li>
	<li><ks>RobotBoundaryLogic</ks>: the implementation of RobotMoveLogic for the application that makes the robot able to walk around the boundary of the room, as specified in the requirements;</li>
	<li><ks>RobotController</ks>: the controller of the application; we decide to create our controller class instead of use the given RobotInputController.</li>
</ul>
It's very important to say that <k>the controller is not a thread</k> thanks to the asynchronous interaction: the method <em>setCanProceeded(boolean canProceeded)</em> set the relative attribute of the class but also check if its value is changed. If <ks>canProceeded</ks> is passed from false to true, so the controller must use the support to send the next command but in the reverse case the controller must send the halt command. In addition to this, since the controller is an IssSupportObserver, after a movements, the same thread of the support immediately send in ansynchronous way the new command obtained from the RobotMoveLogic</br>
Because of the importance of this class, we show his code:
<pre>
<k>public class</k> RobotController implements IssSupportObserver {

    <k>private</k> RobotMovesInfo robotMovesInfo;
    <k>private</k> RobotMoveLogic robotMoveLogic;
    <k>private</k> IssObservableSupport support;

    <k>private</k> AtomicBoolean canProceed;

    <k>public</k> RobotController() throws NoSuchIssProtocolException, DeploymentException,
            IOException, URISyntaxException {
        support = IssObservableSupportFactory.createSupport();
        canProceed = new AtomicBoolean(false);
        robotMovesInfo = new RobotMovesInfo(false);
        robotMoveLogic = new RobotBoundaryLogic(robotMovesInfo);

        support.attachObserver(this);
    }

    <k>public</k> void setCanProceed(boolean canProceed) throws IOException, IllegalMovementException {
       boolean oldValue = this.canProceed.getAndSet(canProceed);

        if(canProceed == true &amp&amp oldValue != canProceed) {
            Optional<RobotCommand> cmd = Optional.empty();
            while(!(cmd = robotMoveLogic.askForNext()).isPresent());

            support.requestAsync(cmd.get());
        }

        else if(canProceed == false &amp&amp oldValue != canProceed) {
            support.requestAsync(CommandFactory.createCommand(Move.ALARM, 10));
        }
    }

    <k>public</k> void close() throws IOException {
        support.detachObserver(this);
        support.close();
    }

    <ks>@Override</ks>
    <k>public</k> void onAsyncRequest(RobotCommand command) {}

    <ks>@Override</ks>
    <k>public</k> void onSyncRequest(RobotCommand command, RobotMovement movement) {}

   <ks>@Override</ks>
    <k>public</k> void onRobotMovement(RobotMovement movement) {
        robotMovesInfo.addNewExecutedMovement(movement);
        Optional&leqRobotCommand&geq cmd = Optional.empty();
        try {
             cmd = robotMoveLogic.askForNext();
        } catch (IllegalMovementException e) {
            e.printStackTrace();
        }

        if(canProceed.get()) {
            if(cmd.isPresent()) {
                try {
                    support.requestAsync(cmd.get());
                } catch (IOException e) {
                    e.printStackTrace();
                }
            } else {
                System.out.println("Boundary done. Jouney: " + robotMovesInfo.getMovesRepresentationAndClean());
                canProceed.set(false);
            }
        }

    }

    <ks>@Override</ks>
    <k>public</k> void onRobotInformation(RobotInformation information) {}
}
</pre>

We also specify that the attribute <ks>TRANSLATIONS</ks> of the class RobotMoves contains the string representation for all moves meanwhile the two variable <ks>DEFAULT_WTIME</ks> and <ks>DEFAULT_LTIME</ks> in RobotBoundaryLogic contain the default values for the time of the move forward and of turn left movements. In a future development their values could be taken from a configuration file in order to be most suitable.</br></br>
	</td></tr>
<tr><td>
<h3>Gui Level (package <ks>it.unibo.resumableBoundaryWalker.gui</ks> and class <ks>it.unibo.resumableBoundaryWalker.ResumableBoundaryWalker</ks>)</h3>
	The package provides the required elements in order to build the GUI interface. We specify that we haven't used the given class <ks>ConsoleGui</ks> because it uses some deprecated methods. In addition to, instead AWT, we felt that <em>JavaFX</em> is most updated and suitable in order to realize the graphical interfaces. Then, the classes projected in the following UML uses the <a href="https://java.com/it/javafx/" target="jfx"><em>javafx library</em></a>.</br></br>
	<center><img src="./img/it.unibo.resumableBoundaryWalk.gui.png" alt="controller_uml" width="70%" ></center></br></br>
<ul>
	<li><ks>MainPane</ks>: the class that realizes the main pane of the graphical interface; it contains the two buttons requested by the requirements; as specified in JavaFX documentation, the two methods <ks>onResumeButtonPressed</ks> and <ks>onStopButtonPressed</ks> are the <a href="https://docs.oracle.com/javase/tutorial/uiswing/events/index.html" target="jfx"><em>Action Listeners</em></a> of the two button that invoke the relative method of the controller;</li>
	<li><ks>AlertManager</ks>: a simple static class that make showing popup more easier;</li>
	<li><ks>ResumableBoudaryWalker</ks>: the main class of the application that paints the graphical interface also initializing all components (see <a href="https://docs.oracle.com/javase/8/javafx/api/javafx/application/Application.html" target="jfx"><em>javafx.application.Application</em></a>);</li>
</ul>
</td></tr>
		</tbody>
	</table>
	
</div>

 
</div>

<h2>Testing</h2>
<div class="remark">
	In order to test the requirement of the boundary and of the production of the final string, we have produced a JUNIT test that uses the maded classes.
	To perform the test, it's needed to access to the variables <ks>canProceeded</ks> and <ks>robotMovesInfo</ks> of the RobotController, so we have added three new methods to this class: <ks>getIsProceeding(): boolean</ks>, <ks>getIssSupport(): IssObservableSupport</ks> and <ks>getLatJouney(): String</ks>.
	<pre>
<k>class</k> IssSupportObserverForTest implements IssSupportObserver {

    <k>private static</k> Map<Move, String> TRANSLATIONS = new HashMap<>();
    <k>static</k> {
        TRANSLATIONS.put(Move.MOVE_FORWARD, <kc>"w"</kc>);
        TRANSLATIONS.put(Move.MOVE_BACKWARD, <kc>"b"</kc>);
        TRANSLATIONS.put(Move.TURN_LEFT, <kc>"l"</kc>);
        TRANSLATIONS.put(Move.TURN_RIGHT, <kc>"r"</kc>);
    }

    <k>private</k> String moves;

    <k>public</k> IssSupportObserverForTest() {
        this.moves = <kc>""</kc>;
    }

    <k>public</k> String getMoves() {
        return this.moves;
    }

    <ks>@Override</ks>
    <k>public</k> void onAsyncRequest(RobotCommand command) {}

    <ks>@Override</ks>
    <k>public</k> void onSyncRequest(RobotCommand command, RobotMovement movement) {}

    <ks>@Override</ks>
    <k>public</k> void onRobotMovement(RobotMovement movement) {
        moves += TRANSLATIONS.get(movement.getMove());
    }

    <ks>@Override</ks>
    <k>public</k> void onRobotInformation(RobotInformation information) {}
}

<k>public class</k> AppTest {

    <k>private</k> RobotController controller;
    <k>private</k> IssSupportObserverForTest observer;

    <ks>@Before</ks>
    <k>public</k> void init() throws Exception {
        controller = new RobotController();
        observer = new IssSupportObserverForTest();

        controller.getSupport().attachObserver(observer);
        controller.setCanProceed(true);
    }

    <ks>@Test</ks>
    <k>public</k> void testDoBoundary() throws InterruptedException {
        while(controller.isProceeding() == true)
            Thread.sleep(1000);

        String moves = controller.getLastJouney();
        String obtainedFromTest = observer.getMoves();

        assertEquals(moves, obtainedFromTest);
        assertTrue(moves.matches(<kc>"w+lw+lw+lw+l"</kc>));
    }
}
	</pre>
</div>
 

<h2>Deployment</h2> 
The deployment consists in the commit of the application on a project named <ks>iss2021_resumablebw</ks> of the MY GIT repository ( <k>RRR</k> ).
<br/><br/>
The final commit commit has done after <k>XXX</k> hours of work.
 
<h2>Maintenance</h2> 
 
<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
 QUESTIONS:
chiarisce cosa il committente intende con 'Optionally'  
chiarisce cosa il committente intende con 'should remember' 
chiarisce cosa il committente intende con 'mental map'
definisce la user story in modo da comprendere TUTTI i requisiti (anche opzionali)
discute se sia meglio avvalersi di HTTP o delle websocket e perchè
discute se sia meglio usare il linguaggio di comando cril, aril (o altro) e perchè
discute se sia meglio muovere il robot in modo random o in modo organizzato 
discute se il ritorno alla den debba/possa avvenire senza ricalcare il percorso effettuato
presenta ogni TestPlan collegandolo ad una user story e in modo 'concreto' (non come un insieme di intenti)
propone diverse tipologie di scene/situazioni per il testing
individua e propone (motivandola) una lista di priorità per il soddisfacimento dei requisiti 
presenta una stima dei tempi di realizzazione 
presenta un elenco delle risorse che sarebbe opportuno avere e/o procurarsi
presenta una architettura di progetto
presenta dettagli di progetto che permettono una precisa implementazione da parte di chi legge
pone in evidenza le parti di funzionamento proattivo e quelle di funzionamento reattivo
ECCEDE nelle dimensioni del file (al momento > 1600Kb)


-->
	      	
<br/><br/> 	
</div>  

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:center;color:white; margin: auto">
<p>By student</br>
    Name: Luca Marchegiani</br>
    Email: luca.marchegiani3@studio.unibo.it</br>
    Git Repo:  <a href="https://github.com/LM-96/MarchegianiLuca" target="web" style="color:white">https://github.com/LM-96/MarchegianiLuca</a></p>
<img src="./img/profile_2.png" alt="mbot" width="40%" height="40%">
</div> 
</body>
</html>